<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagram Labels — Singapore Primary Science Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../style.css">
  <style>
    /* ── Page layout ── */
    .page-wrap {
      max-width: 860px;
      margin: 0 auto;
      padding: 1.5rem 1rem 4rem;
    }

    /* ── Header ── */
    .page-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      color: var(--muted);
      text-decoration: none;
      font-size: .85rem;
      font-weight: 600;
      padding: .4rem .8rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      transition: all .18s;
      white-space: nowrap;
      margin-top: .15rem;
    }
    .back-link:hover { color: var(--text); border-color: var(--accent); background: var(--surface); }
    .header-text { flex: 1; min-width: 0; }
    .header-text h1 { font-size: 1.75rem; margin-bottom: .25rem; }
    .header-text p  { font-size: .9rem; color: var(--muted); margin: 0; }

    /* ── Tab bar with session score ── */
    .tab-bar-row {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .diagram-tabs {
      display: flex;
      gap: .4rem;
      flex-wrap: wrap;
      flex: 1;
    }
    .dtab {
      padding: .5rem 1rem;
      border-radius: 99px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      font-size: .83rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .18s;
      white-space: nowrap;
    }
    .dtab:hover { border-color: var(--accent); color: var(--accent); }
    .dtab.active { background: var(--accent); color: #0f172a; border-color: var(--accent); }
    .dtab.done   { border-color: #34d399; color: #34d399; }
    .dtab.done.active { background: #14532d; border-color: #34d399; color: #6ee7b7; }

    .session-score {
      font-size: .82rem;
      font-weight: 700;
      color: var(--muted);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 99px;
      padding: .4rem .9rem;
      white-space: nowrap;
    }
    .session-score .score-val { color: var(--accent); }

    /* ── Diagram pane ── */
    .diagram-pane { display: none; }
    .diagram-pane.active { display: block; }

    .pane-header {
      display: flex;
      align-items: baseline;
      gap: .75rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .pane-header h2 { font-size: 1.2rem; }
    .pane-instruction { font-size: .85rem; color: var(--muted); margin: 0; }

    /* ── SVG container ── */
    .svg-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1.25rem;
      display: flex;
      justify-content: center;
      overflow: hidden;
    }
    .svg-container svg {
      width: 100%;
      max-width: 480px;
      height: auto;
      display: block;
    }

    /* ── Label slot (SVG circle) states via CSS classes ── */
    .slot-circle {
      cursor: pointer;
    }
    .slot-bg { fill: #334155; stroke: #64748b; stroke-width: 2; }
    .slot-text { fill: #e2e8f0; font-weight: 700; pointer-events: none; }
    .slot-group.selected .slot-bg { fill: #1e3a5a; stroke: #38bdf8; }
    .slot-group.correct  .slot-bg { fill: #14532d; stroke: #34d399; }
    .slot-group.wrong    .slot-bg { fill: #3b0f0f; stroke: #ef4444; }
    .slot-group.correct  .slot-text { fill: #6ee7b7; }
    .slot-group.wrong    .slot-text { fill: #fca5a5; }

    /* placed label near slot */
    .placed-label { pointer-events: none; font-size: 9px; fill: #94a3b8; }
    .slot-group.selected .placed-label { fill: #38bdf8; }
    .slot-group.correct  .placed-label { fill: #34d399; }
    .slot-group.wrong    .placed-label { fill: #ef4444; }

    /* ── Word bank ── */
    .word-bank {
      display: flex;
      flex-wrap: wrap;
      gap: .45rem;
      margin-bottom: 1.25rem;
    }
    .word-chip {
      padding: .4rem .9rem;
      border-radius: 99px;
      border: 1.5px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-size: .83rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .18s;
      user-select: none;
    }
    .word-chip:hover:not(.placed):not(.locked) { border-color: var(--accent); color: var(--accent); }
    .word-chip.placed  { opacity: 0.38; cursor: default; }
    .word-chip.locked  { cursor: default; }
    .word-chip.chip-correct { background: #063b27; border-color: #34d399; color: #6ee7b7; opacity: 1; }
    .word-chip.chip-wrong   { background: #3b0f0f; border-color: #ef4444; color: #fca5a5; opacity: 1; }

    /* ── Controls row ── */
    .controls-row {
      display: flex;
      align-items: center;
      gap: .75rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    /* ── Score display ── */
    .score-display {
      display: none;
      margin-top: .75rem;
      padding: .85rem 1.1rem;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 700;
      text-align: center;
    }
    .score-display.show { display: block; }
    .score-display.all-correct { background: #063b27; border: 1px solid #34d399; color: #6ee7b7; }
    .score-display.partial     { background: #2e2105; border: 1px solid var(--energy); color: #fcd34d; }
    .score-display.none-correct{ background: #3b0f0f; border: 1px solid #ef4444; color: #fca5a5; }

    .wrong-answer-note {
      font-size: .78rem;
      font-weight: 400;
      color: inherit;
      margin-top: .4rem;
      opacity: .85;
    }

    /* ── Responsive ── */
    @media (max-width: 600px) {
      .page-header { flex-direction: column; gap: .6rem; }
      .dtab { font-size: .78rem; padding: .4rem .75rem; }
    }
  </style>
</head>
<body>
<div class="page-wrap">

  <!-- Page header -->
  <header class="page-header">
    <a href="../index.html" class="back-link">&#8592; Hub</a>
    <div class="header-text">
      <h1>Diagram Labels</h1>
      <p>Click a numbered slot, then click a term to place it. Check your labels when ready.</p>
    </div>
  </header>

  <!-- Tab bar row -->
  <div class="tab-bar-row">
    <nav class="diagram-tabs" aria-label="Diagram selector">
      <button class="dtab active" data-diagram="0">Heart</button>
      <button class="dtab" data-diagram="1">Digestive</button>
      <button class="dtab" data-diagram="2">Breathing</button>
      <button class="dtab" data-diagram="3">Plant Cell</button>
      <button class="dtab" data-diagram="4">Water Cycle</button>
      <button class="dtab" data-diagram="5">Circuit</button>
    </nav>
    <div class="session-score">
      Completed: <span class="score-val" id="session-score-val">0</span> / 6
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       DIAGRAM 0 — THE HEART
       ══════════════════════════════════════════════════════════ -->
  <div class="diagram-pane active" id="pane-0">
    <div class="pane-header">
      <h2>The Heart</h2>
      <p class="pane-instruction">Label the four chambers and two major vessels.</p>
    </div>
    <div class="svg-container">
      <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg" aria-label="Heart diagram">
        <!-- Background -->
        <rect width="400" height="320" fill="#1e293b" rx="12"/>

        <!-- Right side (deoxygenated — blue tint) -->
        <!-- Right atrium -->
        <rect x="215" y="80" width="90" height="70" rx="12" fill="#1e3a5a" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="260" y="120" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Right</text>
        <text x="260" y="131" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Atrium</text>

        <!-- Right ventricle -->
        <rect x="215" y="158" width="90" height="85" rx="10" fill="#1e3a5a" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="260" y="202" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Right</text>
        <text x="260" y="213" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Ventricle</text>

        <!-- Left side (oxygenated — red tint) -->
        <!-- Left atrium -->
        <rect x="95" y="80" width="90" height="70" rx="12" fill="#7f1d1d" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="140" y="120" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Left</text>
        <text x="140" y="131" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Atrium</text>

        <!-- Left ventricle -->
        <rect x="95" y="158" width="90" height="85" rx="10" fill="#7f1d1d" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="140" y="202" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Left</text>
        <text x="140" y="213" text-anchor="middle" font-size="9" fill="#94a3b8" font-family="Inter,sans-serif">Ventricle</text>

        <!-- Septum (divider) -->
        <line x1="207" y1="75" x2="207" y2="248" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4,3"/>

        <!-- Tricuspid valve line (right) -->
        <line x1="215" y1="154" x2="305" y2="154" stroke="#64748b" stroke-width="1.5"/>
        <!-- Mitral valve line (left) -->
        <line x1="95" y1="154" x2="185" y2="154" stroke="#64748b" stroke-width="1.5"/>

        <!-- Aorta (left side, top) -->
        <path d="M130 80 Q130 52 150 44 Q170 36 185 40 L185 55 Q172 51 155 57 Q142 62 142 80Z" fill="#7f1d1d" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="148" y="50" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Aorta</text>

        <!-- Pulmonary artery (right side, top) -->
        <path d="M260 80 Q260 54 243 46 Q228 40 215 44 L215 58 Q226 55 238 60 Q248 65 248 80Z" fill="#1e3a5a" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="248" y="52" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Pulm.</text>
        <text x="248" y="62" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">artery</text>

        <!-- Vena cava (right, top) -->
        <rect x="305" y="88" width="22" height="40" rx="4" fill="#1e3a5a" stroke="#64748b" stroke-width="1"/>
        <text x="316" y="112" text-anchor="middle" font-size="7" fill="#64748b" font-family="Inter,sans-serif">SVC</text>

        <!-- Pulmonary vein (left, top) -->
        <rect x="73" y="88" width="22" height="40" rx="4" fill="#7f1d1d" stroke="#64748b" stroke-width="1"/>
        <text x="84" y="112" text-anchor="middle" font-size="7" fill="#64748b" font-family="Inter,sans-serif">PV</text>

        <!-- Leader lines and slot circles -->

        <!-- Slot 1 — Right atrium (top right) -->
        <g class="slot-group" data-slot="1" data-diagram="0" style="cursor:pointer">
          <line x1="305" y1="115" x2="340" y2="115" stroke="#64748b" stroke-width="1.5"/>
          <circle class="slot-circle" cx="354" cy="115" r="14" class="slot-bg"/>
          <circle cx="354" cy="115" r="14" class="slot-bg"/>
          <text x="354" y="119.5" text-anchor="middle" font-size="11" class="slot-text">1</text>
          <text x="354" y="136" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 2 — Left atrium (top left) -->
        <g class="slot-group" data-slot="2" data-diagram="0" style="cursor:pointer">
          <line x1="73" y1="115" x2="42" y2="115" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="28" cy="115" r="14" class="slot-bg"/>
          <text x="28" y="119.5" text-anchor="middle" font-size="11" class="slot-text">2</text>
          <text x="28" y="136" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 3 — Right ventricle (bottom right) -->
        <g class="slot-group" data-slot="3" data-diagram="0" style="cursor:pointer">
          <line x1="305" y1="200" x2="340" y2="200" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="354" cy="200" r="14" class="slot-bg"/>
          <text x="354" y="204.5" text-anchor="middle" font-size="11" class="slot-text">3</text>
          <text x="354" y="220" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 4 — Left ventricle (bottom left) -->
        <g class="slot-group" data-slot="4" data-diagram="0" style="cursor:pointer">
          <line x1="95" y1="200" x2="42" y2="200" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="28" cy="200" r="14" class="slot-bg"/>
          <text x="28" y="204.5" text-anchor="middle" font-size="11" class="slot-text">4</text>
          <text x="28" y="220" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 5 — Aorta (top left vessel) -->
        <g class="slot-group" data-slot="5" data-diagram="0" style="cursor:pointer">
          <line x1="148" y1="42" x2="148" y2="20" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="148" cy="14" r="14" class="slot-bg"/>
          <text x="148" y="18.5" text-anchor="middle" font-size="11" class="slot-text">5</text>
          <text x="148" y="35" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 6 — Pulmonary artery (top right vessel) -->
        <g class="slot-group" data-slot="6" data-diagram="0" style="cursor:pointer">
          <line x1="248" y1="44" x2="248" y2="20" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="248" cy="14" r="14" class="slot-bg"/>
          <text x="248" y="18.5" text-anchor="middle" font-size="11" class="slot-text">6</text>
          <text x="248" y="35" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Diagram legend -->
        <rect x="8" y="258" width="12" height="12" rx="2" fill="#7f1d1d" stroke="#94a3b8" stroke-width="1"/>
        <text x="24" y="269" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Oxygenated blood (left)</text>
        <rect x="160" y="258" width="12" height="12" rx="2" fill="#1e3a5a" stroke="#94a3b8" stroke-width="1"/>
        <text x="176" y="269" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Deoxygenated blood (right)</text>
      </svg>
    </div>
    <div class="word-bank" id="bank-0">
      <button class="word-chip" data-term="Right atrium">Right atrium</button>
      <button class="word-chip" data-term="Left atrium">Left atrium</button>
      <button class="word-chip" data-term="Right ventricle">Right ventricle</button>
      <button class="word-chip" data-term="Left ventricle">Left ventricle</button>
      <button class="word-chip" data-term="Aorta">Aorta</button>
      <button class="word-chip" data-term="Pulmonary artery">Pulmonary artery</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="check-0">Check my labels</button>
      <button class="btn btn-ghost" id="reset-0">Reset</button>
    </div>
    <div class="score-display" id="score-0"></div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       DIAGRAM 1 — DIGESTIVE SYSTEM
       ══════════════════════════════════════════════════════════ -->
  <div class="diagram-pane" id="pane-1">
    <div class="pane-header">
      <h2>The Digestive System</h2>
      <p class="pane-instruction">Label each part of the digestive tract from top to bottom.</p>
    </div>
    <div class="svg-container">
      <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg" aria-label="Digestive system diagram">
        <rect width="400" height="320" fill="#1e293b" rx="12"/>

        <!-- Mouth (top) -->
        <ellipse cx="200" cy="32" rx="36" ry="18" fill="#2d3e50" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="200" y="36" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Mouth</text>

        <!-- Oesophagus (tube) -->
        <rect x="188" y="50" width="24" height="52" rx="5" fill="#243347" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="200" y="78" text-anchor="middle" font-size="7" fill="#94a3b8" font-family="Inter,sans-serif">Oes.</text>

        <!-- Stomach -->
        <path d="M170 104 Q155 108 152 125 Q149 145 162 158 Q175 170 200 170 Q222 170 228 155 Q234 140 228 120 Q224 104 212 102 Z"
              fill="#374151" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="190" y="138" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Stomach</text>

        <!-- Small intestine (coiled) -->
        <path d="M185 172 Q150 172 148 188 Q146 205 175 210 Q200 212 215 204 Q230 196 220 184 Q210 173 195 178 Q178 184 180 198 Q182 212 200 218"
              fill="none" stroke="#94a3b8" stroke-width="10" stroke-linecap="round"/>
        <path d="M185 172 Q150 172 148 188 Q146 205 175 210 Q200 212 215 204 Q230 196 220 184 Q210 173 195 178 Q178 184 180 198 Q182 212 200 218"
              fill="none" stroke="#2d4a3e" stroke-width="8" stroke-linecap="round"/>

        <!-- Large intestine (wider, U-shape on sides) -->
        <path d="M200 218 Q200 240 175 246 Q148 252 146 272 Q145 290 165 296 L235 296 Q255 292 254 272 Q253 252 228 246 Q206 240 206 218"
              fill="none" stroke="#94a3b8" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M200 218 Q200 240 175 246 Q148 252 146 272 Q145 290 165 296 L235 296 Q255 292 254 272 Q253 252 228 246 Q206 240 206 218"
              fill="none" stroke="#3a2d1a" stroke-width="12" stroke-linecap="round" stroke-linejoin="round"/>

        <!-- Anus (bottom) -->
        <ellipse cx="200" cy="305" rx="14" ry="7" fill="#2d3e50" stroke="#94a3b8" stroke-width="1.5"/>
        <text x="200" y="308" text-anchor="middle" font-size="7" fill="#94a3b8" font-family="Inter,sans-serif">Anus</text>

        <!-- Slot 1 — Mouth -->
        <g class="slot-group" data-slot="1" data-diagram="1" style="cursor:pointer">
          <line x1="236" y1="32" x2="264" y2="32" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="278" cy="32" r="14" class="slot-bg"/>
          <text x="278" y="36.5" text-anchor="middle" font-size="11" class="slot-text">1</text>
          <text x="278" y="54" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 2 — Oesophagus -->
        <g class="slot-group" data-slot="2" data-diagram="1" style="cursor:pointer">
          <line x1="212" y1="72" x2="264" y2="72" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="278" cy="72" r="14" class="slot-bg"/>
          <text x="278" y="76.5" text-anchor="middle" font-size="11" class="slot-text">2</text>
          <text x="278" y="93" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 3 — Stomach -->
        <g class="slot-group" data-slot="3" data-diagram="1" style="cursor:pointer">
          <line x1="234" y1="136" x2="264" y2="136" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="278" cy="136" r="14" class="slot-bg"/>
          <text x="278" y="140.5" text-anchor="middle" font-size="11" class="slot-text">3</text>
          <text x="278" y="157" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 4 — Small intestine -->
        <g class="slot-group" data-slot="4" data-diagram="1" style="cursor:pointer">
          <line x1="230" y1="193" x2="264" y2="193" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="278" cy="193" r="14" class="slot-bg"/>
          <text x="278" y="197.5" text-anchor="middle" font-size="11" class="slot-text">4</text>
          <text x="278" y="214" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 5 — Large intestine -->
        <g class="slot-group" data-slot="5" data-diagram="1" style="cursor:pointer">
          <line x1="259" y1="266" x2="308" y2="266" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="322" cy="266" r="14" class="slot-bg"/>
          <text x="322" y="270.5" text-anchor="middle" font-size="11" class="slot-text">5</text>
          <text x="322" y="287" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 6 — Anus -->
        <g class="slot-group" data-slot="6" data-diagram="1" style="cursor:pointer">
          <line x1="136" y1="305" x2="108" y2="305" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="94" cy="305" r="14" class="slot-bg"/>
          <text x="94" y="309.5" text-anchor="middle" font-size="11" class="slot-text">6</text>
          <text x="94" y="289" text-anchor="middle" class="placed-label"></text>
        </g>
      </svg>
    </div>
    <div class="word-bank" id="bank-1">
      <button class="word-chip" data-term="Mouth">Mouth</button>
      <button class="word-chip" data-term="Oesophagus">Oesophagus</button>
      <button class="word-chip" data-term="Stomach">Stomach</button>
      <button class="word-chip" data-term="Small intestine">Small intestine</button>
      <button class="word-chip" data-term="Large intestine">Large intestine</button>
      <button class="word-chip" data-term="Anus">Anus</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="check-1">Check my labels</button>
      <button class="btn btn-ghost" id="reset-1">Reset</button>
    </div>
    <div class="score-display" id="score-1"></div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       DIAGRAM 2 — BREATHING SYSTEM
       ══════════════════════════════════════════════════════════ -->
  <div class="diagram-pane" id="pane-2">
    <div class="pane-header">
      <h2>The Breathing System</h2>
      <p class="pane-instruction">Label the main parts of the respiratory system.</p>
    </div>
    <div class="svg-container">
      <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg" aria-label="Breathing system diagram">
        <rect width="400" height="320" fill="#1e293b" rx="12"/>

        <!-- Ribcage outline (arched sides) -->
        <!-- Left ribs -->
        <path d="M130 100 Q82 118 80 160 Q80 200 110 218" fill="none" stroke="#475569" stroke-width="1.5" stroke-dasharray="6,3"/>
        <path d="M134 115 Q88 132 86 168 Q86 202 112 216" fill="none" stroke="#475569" stroke-width="1" stroke-dasharray="5,3" opacity="0.6"/>
        <path d="M138 130 Q96 148 94 178 Q94 204 116 214" fill="none" stroke="#475569" stroke-width="1" stroke-dasharray="4,3" opacity="0.4"/>
        <!-- Right ribs -->
        <path d="M270 100 Q318 118 320 160 Q320 200 290 218" fill="none" stroke="#475569" stroke-width="1.5" stroke-dasharray="6,3"/>
        <path d="M266 115 Q312 132 314 168 Q314 202 288 216" fill="none" stroke="#475569" stroke-width="1" stroke-dasharray="5,3" opacity="0.6"/>
        <path d="M262 130 Q304 148 306 178 Q306 204 284 214" fill="none" stroke="#475569" stroke-width="1" stroke-dasharray="4,3" opacity="0.4"/>

        <!-- Trachea (windpipe) -->
        <rect x="190" y="30" width="20" height="65" rx="5" fill="#243347" stroke="#94a3b8" stroke-width="1.5"/>
        <line x1="194" y1="35" x2="194" y2="92" stroke="#64748b" stroke-width="1" stroke-dasharray="3,3"/>
        <line x1="206" y1="35" x2="206" y2="92" stroke="#64748b" stroke-width="1" stroke-dasharray="3,3"/>

        <!-- Bronchi (two branches) -->
        <path d="M190 92 Q172 92 160 110" fill="none" stroke="#94a3b8" stroke-width="8" stroke-linecap="round"/>
        <path d="M210 92 Q228 92 240 110" fill="none" stroke="#94a3b8" stroke-width="8" stroke-linecap="round"/>
        <path d="M190 92 Q172 92 160 110" fill="none" stroke="#243347" stroke-width="5" stroke-linecap="round"/>
        <path d="M210 92 Q228 92 240 110" fill="none" stroke="#243347" stroke-width="5" stroke-linecap="round"/>

        <!-- Left lung -->
        <path d="M100 108 Q82 120 80 160 Q78 205 120 228 Q142 238 160 230 Q175 222 172 200 Q170 180 160 110 Q150 100 132 104 Z"
              fill="#172554" stroke="#94a3b8" stroke-width="1.5"/>

        <!-- Right lung -->
        <path d="M300 108 Q318 120 320 160 Q322 205 280 228 Q258 238 240 230 Q225 222 228 200 Q230 180 240 110 Q250 100 268 104 Z"
              fill="#172554" stroke="#94a3b8" stroke-width="1.5"/>

        <!-- Diaphragm -->
        <path d="M80 230 Q200 265 320 230" fill="none" stroke="#94a3b8" stroke-width="3" stroke-linecap="round"/>
        <path d="M80 230 Q200 268 320 230" fill="#172554" stroke="none" opacity="0.3"/>

        <!-- Slot 1 — Trachea -->
        <g class="slot-group" data-slot="1" data-diagram="2" style="cursor:pointer">
          <line x1="210" y1="52" x2="260" y2="52" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="274" cy="52" r="14" class="slot-bg"/>
          <text x="274" y="56.5" text-anchor="middle" font-size="11" class="slot-text">1</text>
          <text x="274" y="74" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 2 — Bronchi -->
        <g class="slot-group" data-slot="2" data-diagram="2" style="cursor:pointer">
          <line x1="246" y1="100" x2="280" y2="100" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="294" cy="100" r="14" class="slot-bg"/>
          <text x="294" y="104.5" text-anchor="middle" font-size="11" class="slot-text">2</text>
          <text x="294" y="121" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 3 — Lungs -->
        <g class="slot-group" data-slot="3" data-diagram="2" style="cursor:pointer">
          <line x1="80" y1="165" x2="42" y2="165" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="28" cy="165" r="14" class="slot-bg"/>
          <text x="28" y="169.5" text-anchor="middle" font-size="11" class="slot-text">3</text>
          <text x="28" y="186" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 4 — Diaphragm -->
        <g class="slot-group" data-slot="4" data-diagram="2" style="cursor:pointer">
          <line x1="200" y1="260" x2="200" y2="290" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="200" cy="304" r="14" class="slot-bg"/>
          <text x="200" y="308.5" text-anchor="middle" font-size="11" class="slot-text">4</text>
          <text x="200" y="289" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 5 — Ribcage -->
        <g class="slot-group" data-slot="5" data-diagram="2" style="cursor:pointer">
          <line x1="320" y1="165" x2="358" y2="165" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="372" cy="165" r="14" class="slot-bg"/>
          <text x="372" y="169.5" text-anchor="middle" font-size="11" class="slot-text">5</text>
          <text x="372" y="186" text-anchor="middle" class="placed-label"></text>
        </g>
      </svg>
    </div>
    <div class="word-bank" id="bank-2">
      <button class="word-chip" data-term="Trachea">Trachea</button>
      <button class="word-chip" data-term="Bronchi">Bronchi</button>
      <button class="word-chip" data-term="Lungs">Lungs</button>
      <button class="word-chip" data-term="Diaphragm">Diaphragm</button>
      <button class="word-chip" data-term="Ribcage">Ribcage</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="check-2">Check my labels</button>
      <button class="btn btn-ghost" id="reset-2">Reset</button>
    </div>
    <div class="score-display" id="score-2"></div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       DIAGRAM 3 — PLANT CELL
       ══════════════════════════════════════════════════════════ -->
  <div class="diagram-pane" id="pane-3">
    <div class="pane-header">
      <h2>The Plant Cell</h2>
      <p class="pane-instruction">Label each organelle and structure of the plant cell.</p>
    </div>
    <div class="svg-container">
      <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg" aria-label="Plant cell diagram">
        <rect width="400" height="320" fill="#1e293b" rx="12"/>

        <!-- Cell wall (outer) -->
        <rect x="60" y="30" width="280" height="248" rx="8" fill="#14532d" stroke="#4ade80" stroke-width="5"/>

        <!-- Cell membrane (just inside wall) -->
        <rect x="72" y="42" width="256" height="224" rx="4" fill="#1e293b" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4,2"/>

        <!-- Vacuole (large central space) -->
        <ellipse cx="200" cy="168" rx="90" ry="76" fill="#0c2340" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="5,3"/>
        <text x="200" y="172" text-anchor="middle" font-size="8" fill="#3b82f6" font-family="Inter,sans-serif">Vacuole</text>

        <!-- Nucleus (off-centre, not inside vacuole) -->
        <ellipse cx="200" cy="105" rx="38" ry="28" fill="#2d1a4a" stroke="#8b5cf6" stroke-width="2"/>
        <!-- Nuclear membrane detail -->
        <ellipse cx="200" cy="105" rx="30" ry="20" fill="none" stroke="#6d28d9" stroke-width="1" stroke-dasharray="3,2"/>
        <!-- Nucleolus -->
        <circle cx="200" cy="105" r="8" fill="#4c1d95"/>
        <text x="200" y="109" text-anchor="middle" font-size="7" fill="#c4b5fd" font-family="Inter,sans-serif">N</text>

        <!-- Chloroplasts (small, green oval shapes) -->
        <ellipse cx="112" cy="90" rx="18" ry="11" fill="#15803d" stroke="#4ade80" stroke-width="1.5"/>
        <line x1="96" y1="90" x2="130" y2="90" stroke="#4ade80" stroke-width="0.75"/>
        <ellipse cx="148" cy="72" rx="16" ry="10" fill="#15803d" stroke="#4ade80" stroke-width="1.5"/>
        <line x1="134" y1="72" x2="164" y2="72" stroke="#4ade80" stroke-width="0.75"/>
        <ellipse cx="258" cy="85" rx="17" ry="11" fill="#15803d" stroke="#4ade80" stroke-width="1.5"/>
        <line x1="242" y1="85" x2="275" y2="85" stroke="#4ade80" stroke-width="0.75"/>
        <ellipse cx="110" cy="240" rx="16" ry="10" fill="#15803d" stroke="#4ade80" stroke-width="1.5"/>
        <ellipse cx="290" cy="240" rx="16" ry="10" fill="#15803d" stroke="#4ade80" stroke-width="1.5"/>

        <!-- Slot 1 — Cell wall -->
        <g class="slot-group" data-slot="1" data-diagram="3" style="cursor:pointer">
          <line x1="60" y1="155" x2="28" y2="155" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="14" cy="155" r="14" class="slot-bg"/>
          <text x="14" y="159.5" text-anchor="middle" font-size="11" class="slot-text">1</text>
          <text x="14" y="176" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 2 — Cell membrane -->
        <g class="slot-group" data-slot="2" data-diagram="3" style="cursor:pointer">
          <line x1="72" y1="185" x2="44" y2="200" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="30" cy="208" r="14" class="slot-bg"/>
          <text x="30" y="212.5" text-anchor="middle" font-size="11" class="slot-text">2</text>
          <text x="30" y="229" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 3 — Nucleus -->
        <g class="slot-group" data-slot="3" data-diagram="3" style="cursor:pointer">
          <line x1="238" y1="100" x2="272" y2="85" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="286" cy="78" r="14" class="slot-bg"/>
          <text x="286" y="82.5" text-anchor="middle" font-size="11" class="slot-text">3</text>
          <text x="286" y="99" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 4 — Chloroplast -->
        <g class="slot-group" data-slot="4" data-diagram="3" style="cursor:pointer">
          <line x1="112" y1="79" x2="112" y2="55" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="112" cy="41" r="14" class="slot-bg"/>
          <text x="112" y="45.5" text-anchor="middle" font-size="11" class="slot-text">4</text>
          <text x="112" y="62" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 5 — Vacuole -->
        <g class="slot-group" data-slot="5" data-diagram="3" style="cursor:pointer">
          <line x1="290" y1="168" x2="340" y2="168" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="354" cy="168" r="14" class="slot-bg"/>
          <text x="354" y="172.5" text-anchor="middle" font-size="11" class="slot-text">5</text>
          <text x="354" y="189" text-anchor="middle" class="placed-label"></text>
        </g>
      </svg>
    </div>
    <div class="word-bank" id="bank-3">
      <button class="word-chip" data-term="Cell wall">Cell wall</button>
      <button class="word-chip" data-term="Cell membrane">Cell membrane</button>
      <button class="word-chip" data-term="Nucleus">Nucleus</button>
      <button class="word-chip" data-term="Chloroplast">Chloroplast</button>
      <button class="word-chip" data-term="Vacuole">Vacuole</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="check-3">Check my labels</button>
      <button class="btn btn-ghost" id="reset-3">Reset</button>
    </div>
    <div class="score-display" id="score-3"></div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       DIAGRAM 4 — WATER CYCLE
       ══════════════════════════════════════════════════════════ -->
  <div class="diagram-pane" id="pane-4">
    <div class="pane-header">
      <h2>The Water Cycle</h2>
      <p class="pane-instruction">Label the four processes of the water cycle.</p>
    </div>
    <div class="svg-container">
      <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg" aria-label="Water cycle diagram">
        <rect width="400" height="320" fill="#0c1a2e" rx="12"/>

        <!-- Sky gradient area -->
        <rect x="0" y="0" width="400" height="220" rx="12" fill="#0c1a2e"/>
        <!-- Ground -->
        <path d="M0 240 Q100 220 200 230 Q300 240 400 225 L400 320 L0 320 Z" fill="#14532d"/>
        <!-- Hill -->
        <path d="M230 240 Q300 175 370 220 L370 240 Z" fill="#1a6b3a"/>
        <!-- Water/lake -->
        <ellipse cx="95" cy="252" rx="80" ry="22" fill="#172554" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="95" y="257" text-anchor="middle" font-size="8" fill="#60a5fa" font-family="Inter,sans-serif">Water body</text>

        <!-- Sun -->
        <circle cx="356" cy="40" r="26" fill="#fbbf24" opacity="0.85"/>
        <line x1="356" y1="8" x2="356" y2="0" stroke="#fbbf24" stroke-width="2.5"/>
        <line x1="356" y1="72" x2="356" y2="80" stroke="#fbbf24" stroke-width="2.5"/>
        <line x1="322" y1="40" x2="315" y2="40" stroke="#fbbf24" stroke-width="2.5"/>
        <line x1="380" y1="20" x2="386" y2="14" stroke="#fbbf24" stroke-width="2.5"/>
        <line x1="380" y1="60" x2="386" y2="66" stroke="#fbbf24" stroke-width="2.5"/>

        <!-- Cloud -->
        <circle cx="165" cy="68" r="28" fill="#334155" stroke="#94a3b8" stroke-width="1"/>
        <circle cx="195" cy="58" r="22" fill="#334155" stroke="#94a3b8" stroke-width="1"/>
        <circle cx="220" cy="66" r="20" fill="#334155" stroke="#94a3b8" stroke-width="1"/>
        <circle cx="145" cy="72" r="20" fill="#334155" stroke="#94a3b8" stroke-width="1"/>
        <rect x="138" y="70" width="94" height="26" fill="#334155"/>

        <!-- Evaporation arrows (upward from water surface) -->
        <line x1="80" y1="228" x2="64" y2="165" stroke="#38bdf8" stroke-width="2" marker-end="url(#arrowUp)"/>
        <line x1="100" y1="230" x2="88" y2="168" stroke="#38bdf8" stroke-width="2" marker-end="url(#arrowUp)"/>
        <line x1="120" y1="228" x2="110" y2="165" stroke="#38bdf8" stroke-width="2" marker-end="url(#arrowUp)"/>

        <!-- Condensation arrow (curved, at cloud level, rightward) -->
        <path d="M225 62 Q256 54 290 75" fill="none" stroke="#a78bfa" stroke-width="2.5" marker-end="url(#arrowCondense)"/>

        <!-- Precipitation arrows (downward from cloud) -->
        <line x1="155" y1="96" x2="138" y2="175" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowDown)"/>
        <line x1="175" y1="96" x2="162" y2="178" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowDown)"/>
        <line x1="195" y1="94" x2="186" y2="175" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowDown)"/>
        <!-- Raindrops -->
        <ellipse cx="143" cy="145" rx="3" ry="5" fill="#60a5fa" opacity="0.7"/>
        <ellipse cx="163" cy="138" rx="3" ry="5" fill="#60a5fa" opacity="0.7"/>
        <ellipse cx="185" cy="142" rx="3" ry="5" fill="#60a5fa" opacity="0.7"/>

        <!-- Collection arrow (along ground toward lake) -->
        <path d="M280 248 Q220 252 175 252" fill="none" stroke="#34d399" stroke-width="2.5" marker-end="url(#arrowCollect)"/>

        <!-- Arrow markers -->
        <defs>
          <marker id="arrowUp" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
            <path d="M0,8 L4,0 L8,8" fill="none" stroke="#38bdf8" stroke-width="1.5"/>
          </marker>
          <marker id="arrowDown" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
            <path d="M0,0 L4,8 L8,0" fill="none" stroke="#60a5fa" stroke-width="1.5"/>
          </marker>
          <marker id="arrowCondense" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto">
            <path d="M0,0 L8,4 L0,8" fill="none" stroke="#a78bfa" stroke-width="1.5"/>
          </marker>
          <marker id="arrowCollect" markerWidth="8" markerHeight="8" refX="2" refY="4" orient="auto">
            <path d="M8,0 L0,4 L8,8" fill="none" stroke="#34d399" stroke-width="1.5"/>
          </marker>
        </defs>

        <!-- Slot 1 — Evaporation -->
        <g class="slot-group" data-slot="1" data-diagram="4" style="cursor:pointer">
          <line x1="52" y1="188" x2="28" y2="188" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="14" cy="188" r="14" class="slot-bg"/>
          <text x="14" y="192.5" text-anchor="middle" font-size="11" class="slot-text">1</text>
          <text x="14" y="208" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 2 — Condensation -->
        <g class="slot-group" data-slot="2" data-diagram="4" style="cursor:pointer">
          <line x1="290" y1="74" x2="340" y2="62" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="354" cy="58" r="14" class="slot-bg"/>
          <text x="354" y="62.5" text-anchor="middle" font-size="11" class="slot-text">2</text>
          <text x="354" y="78" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 3 — Precipitation -->
        <g class="slot-group" data-slot="3" data-diagram="4" style="cursor:pointer">
          <line x1="136" y1="148" x2="100" y2="140" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="86" cy="137" r="14" class="slot-bg"/>
          <text x="86" y="141.5" text-anchor="middle" font-size="11" class="slot-text">3</text>
          <text x="86" y="121" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 4 — Collection -->
        <g class="slot-group" data-slot="4" data-diagram="4" style="cursor:pointer">
          <line x1="230" y1="262" x2="230" y2="292" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="230" cy="306" r="14" class="slot-bg"/>
          <text x="230" y="310.5" text-anchor="middle" font-size="11" class="slot-text">4</text>
          <text x="230" y="292" text-anchor="middle" class="placed-label"></text>
        </g>
      </svg>
    </div>
    <div class="word-bank" id="bank-4">
      <button class="word-chip" data-term="Evaporation">Evaporation</button>
      <button class="word-chip" data-term="Condensation">Condensation</button>
      <button class="word-chip" data-term="Precipitation">Precipitation</button>
      <button class="word-chip" data-term="Collection">Collection</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="check-4">Check my labels</button>
      <button class="btn btn-ghost" id="reset-4">Reset</button>
    </div>
    <div class="score-display" id="score-4"></div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       DIAGRAM 5 — SERIES CIRCUIT
       ══════════════════════════════════════════════════════════ -->
  <div class="diagram-pane" id="pane-5">
    <div class="pane-header">
      <h2>Series Circuit</h2>
      <p class="pane-instruction">Label the components and conductors in this simple series circuit.</p>
    </div>
    <div class="svg-container">
      <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg" aria-label="Series circuit diagram">
        <rect width="400" height="320" fill="#1e293b" rx="12"/>

        <!-- Circuit loop (wire) -->
        <!-- Top wire -->
        <line x1="80" y1="80" x2="320" y2="80" stroke="#38bdf8" stroke-width="3" stroke-linecap="round"/>
        <!-- Right wire (top to bottom) -->
        <line x1="320" y1="80" x2="320" y2="240" stroke="#38bdf8" stroke-width="3" stroke-linecap="round"/>
        <!-- Bottom wire -->
        <line x1="320" y1="240" x2="80" y2="240" stroke="#38bdf8" stroke-width="3" stroke-linecap="round"/>
        <!-- Left wire (bottom to top) -->
        <line x1="80" y1="240" x2="80" y2="80" stroke="#38bdf8" stroke-width="3" stroke-linecap="round"/>

        <!-- Battery/Cell (left side, vertical) — rectangle with +/- -->
        <rect x="62" y="130" width="36" height="60" rx="4" fill="#1e293b" stroke="#94a3b8" stroke-width="2"/>
        <!-- + plate (thick) -->
        <rect x="58" y="130" width="8" height="18" rx="2" fill="#34d399"/>
        <text x="70" y="127" text-anchor="middle" font-size="10" fill="#34d399" font-weight="bold" font-family="Inter,sans-serif">+</text>
        <!-- - plate (thin) -->
        <rect x="56" y="172" width="8" height="10" rx="1" fill="#f87171"/>
        <text x="70" y="198" text-anchor="middle" font-size="10" fill="#f87171" font-weight="bold" font-family="Inter,sans-serif">-</text>
        <!-- Long positive line -->
        <line x1="62" y1="140" x2="55" y2="140" stroke="#34d399" stroke-width="3"/>
        <!-- Short negative line -->
        <line x1="62" y1="178" x2="56" y2="178" stroke="#f87171" stroke-width="1.5"/>
        <!-- Cell label -->
        <text x="80" y="168" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">Cell</text>

        <!-- Switch (top wire, left portion) -->
        <!-- Gap in top wire at switch position — draw gap then lever -->
        <rect x="135" y="74" width="6" height="14" rx="2" fill="#1e293b"/>
        <rect x="185" y="74" width="6" height="14" rx="2" fill="#1e293b"/>
        <!-- Lever (angled open) -->
        <line x1="138" y1="80" x2="183" y2="65" stroke="#94a3b8" stroke-width="2.5" stroke-linecap="round"/>
        <!-- Pivot dot -->
        <circle cx="138" cy="80" r="4" fill="#94a3b8"/>
        <!-- End dot -->
        <circle cx="185" cy="80" r="3" fill="#94a3b8"/>
        <!-- Switch label -->
        <text x="160" y="62" text-anchor="middle" font-size="8" fill="#94a3b8" font-family="Inter,sans-serif">open switch</text>

        <!-- Bulb (top right area, right wire portion) -->
        <!-- Bulb circle -->
        <circle cx="320" cy="140" r="26" fill="#1e293b" stroke="#fbbf24" stroke-width="2"/>
        <!-- X filament inside bulb -->
        <line x1="305" y1="128" x2="335" y2="152" stroke="#fbbf24" stroke-width="2"/>
        <line x1="335" y1="128" x2="305" y2="152" stroke="#fbbf24" stroke-width="2"/>
        <!-- Glow effect -->
        <circle cx="320" cy="140" r="20" fill="#fbbf24" opacity="0.06"/>
        <!-- Bulb cap -->
        <rect x="308" y="162" width="24" height="10" rx="3" fill="#94a3b8"/>
        <line x1="320" y1="172" x2="320" y2="178" stroke="#38bdf8" stroke-width="3"/>

        <!-- Slot 1 — Battery -->
        <g class="slot-group" data-slot="1" data-diagram="5" style="cursor:pointer">
          <line x1="62" y1="155" x2="30" y2="155" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="16" cy="155" r="14" class="slot-bg"/>
          <text x="16" y="159.5" text-anchor="middle" font-size="11" class="slot-text">1</text>
          <text x="16" y="175" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 2 — Switch -->
        <g class="slot-group" data-slot="2" data-diagram="5" style="cursor:pointer">
          <line x1="160" y1="68" x2="160" y2="42" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="160" cy="28" r="14" class="slot-bg"/>
          <text x="160" y="32.5" text-anchor="middle" font-size="11" class="slot-text">2</text>
          <text x="160" y="48" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 3 — Bulb -->
        <g class="slot-group" data-slot="3" data-diagram="5" style="cursor:pointer">
          <line x1="346" y1="140" x2="378" y2="140" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="386" cy="140" r="14" class="slot-bg"/>
          <text x="386" y="144.5" text-anchor="middle" font-size="11" class="slot-text">3</text>
          <text x="386" y="161" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Slot 4 — Conductor/Wire -->
        <g class="slot-group" data-slot="4" data-diagram="5" style="cursor:pointer">
          <line x1="250" y1="240" x2="250" y2="278" stroke="#64748b" stroke-width="1.5"/>
          <circle cx="250" cy="292" r="14" class="slot-bg"/>
          <text x="250" y="296.5" text-anchor="middle" font-size="11" class="slot-text">4</text>
          <text x="250" y="278" text-anchor="middle" class="placed-label"></text>
        </g>

        <!-- Direction of current label -->
        <text x="200" y="300" text-anchor="middle" font-size="8" fill="#475569" font-family="Inter,sans-serif">conventional current direction: + to -</text>
        <!-- Arrow on top wire showing current direction -->
        <polygon points="265,74 275,80 265,86" fill="#38bdf8" opacity="0.5"/>
      </svg>
    </div>
    <div class="word-bank" id="bank-5">
      <button class="word-chip" data-term="Battery">Battery</button>
      <button class="word-chip" data-term="Switch">Switch</button>
      <button class="word-chip" data-term="Bulb">Bulb</button>
      <button class="word-chip" data-term="Conductor (wire)">Conductor (wire)</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="check-5">Check my labels</button>
      <button class="btn btn-ghost" id="reset-5">Reset</button>
    </div>
    <div class="score-display" id="score-5"></div>
  </div>

</div><!-- /page-wrap -->

<script src="../shared.js"></script>
<script>
// ════════════════════════════════════════════════════════════
//  DIAGRAM LABELLING ENGINE
// ════════════════════════════════════════════════════════════

// ── Diagram definitions ──────────────────────────────────────
const DIAGRAMS = [
  {
    id: 0,
    name: 'Heart',
    slots: {
      1: 'Right atrium',
      2: 'Left atrium',
      3: 'Right ventricle',
      4: 'Left ventricle',
      5: 'Aorta',
      6: 'Pulmonary artery'
    }
  },
  {
    id: 1,
    name: 'Digestive',
    slots: {
      1: 'Mouth',
      2: 'Oesophagus',
      3: 'Stomach',
      4: 'Small intestine',
      5: 'Large intestine',
      6: 'Anus'
    }
  },
  {
    id: 2,
    name: 'Breathing',
    slots: {
      1: 'Trachea',
      2: 'Bronchi',
      3: 'Lungs',
      4: 'Diaphragm',
      5: 'Ribcage'
    }
  },
  {
    id: 3,
    name: 'Plant Cell',
    slots: {
      1: 'Cell wall',
      2: 'Cell membrane',
      3: 'Nucleus',
      4: 'Chloroplast',
      5: 'Vacuole'
    }
  },
  {
    id: 4,
    name: 'Water Cycle',
    slots: {
      1: 'Evaporation',
      2: 'Condensation',
      3: 'Precipitation',
      4: 'Collection'
    }
  },
  {
    id: 5,
    name: 'Circuit',
    slots: {
      1: 'Battery',
      2: 'Switch',
      3: 'Bulb',
      4: 'Conductor (wire)'
    }
  }
];

// ── Per-diagram state ─────────────────────────────────────────
// state[i] = { placed: { slotNum: termString|null }, selectedSlot: null|number, checked: false, score: null, completed: false }
const state = DIAGRAMS.map(d => ({
  placed:       {},
  selectedSlot: null,
  checked:      false,
  score:        null,
  completed:    false
}));

let activeDiagram = 0;

// ── Utility: truncate term for the SVG placed-label text ─────
function truncTerm(term, maxChars = 9) {
  if (!term) return '';
  return term.length > maxChars ? term.slice(0, maxChars - 1) + '…' : term;
}

// ── Session score display ─────────────────────────────────────
function updateSessionScore() {
  const n = state.filter(s => s.completed).length;
  document.getElementById('session-score-val').textContent = n;
}

// ── Switch active diagram tab ─────────────────────────────────
function switchDiagram(index) {
  activeDiagram = index;

  // Update tab buttons
  document.querySelectorAll('.dtab').forEach((btn, i) => {
    btn.classList.toggle('active', i === index);
  });

  // Update pane visibility
  document.querySelectorAll('.diagram-pane').forEach((pane, i) => {
    pane.classList.toggle('active', i === index);
  });
}

// ── Render a slot group to reflect current state ──────────────
function renderSlot(diagramId, slotNum) {
  const s = state[diagramId];
  const group = document.querySelector(
    `.diagram-pane#pane-${diagramId} .slot-group[data-slot="${slotNum}"]`
  );
  if (!group) return;

  // Clear state classes
  group.classList.remove('selected', 'correct', 'wrong');

  const placed = s.placed[slotNum] || null;

  if (s.checked) {
    const correct = DIAGRAMS[diagramId].slots[slotNum];
    if (placed === correct) {
      group.classList.add('correct');
    } else {
      group.classList.add('wrong');
    }
  } else if (s.selectedSlot === slotNum) {
    group.classList.add('selected');
  }

  // Update placed-label text
  const labelEl = group.querySelector('.placed-label');
  if (labelEl) {
    if (s.checked) {
      const correct = DIAGRAMS[diagramId].slots[slotNum];
      if (placed === correct) {
        labelEl.textContent = '✓';
      } else if (placed) {
        labelEl.textContent = '✗';
      } else {
        // Show correct answer if nothing placed
        labelEl.textContent = truncTerm(DIAGRAMS[diagramId].slots[slotNum]);
      }
    } else {
      labelEl.textContent = placed ? truncTerm(placed) : '';
    }
  }

  // Update the slot circle number text (show number always when not checked)
  const numText = group.querySelector('.slot-text');
  if (numText) {
    if (s.checked) {
      const correct = DIAGRAMS[diagramId].slots[slotNum];
      numText.textContent = (placed === correct) ? '✓' : '✗';
    } else {
      numText.textContent = slotNum;
    }
  }
}

// ── Render entire diagram state ───────────────────────────────
function renderDiagram(diagramId) {
  const diag = DIAGRAMS[diagramId];
  const s    = state[diagramId];

  // Render all slots
  Object.keys(diag.slots).forEach(slotNum => {
    renderSlot(diagramId, parseInt(slotNum));
  });

  // Render word bank chips
  const bank = document.getElementById(`bank-${diagramId}`);
  if (bank) {
    bank.querySelectorAll('.word-chip').forEach(chip => {
      const term = chip.dataset.term;
      // Check if this term is placed anywhere
      const isPlaced = Object.values(s.placed).includes(term);
      chip.classList.remove('placed', 'locked', 'chip-correct', 'chip-wrong');

      if (s.checked) {
        chip.classList.add('locked');
        // Find which slot this term belongs to in the answer key
        const correctSlot = Object.entries(diag.slots).find(([, v]) => v === term);
        if (correctSlot) {
          const slotNum = parseInt(correctSlot[0]);
          if (s.placed[slotNum] === term) {
            chip.classList.add('chip-correct');
          } else if (isPlaced) {
            chip.classList.add('chip-wrong');
          }
          // If not placed at all, leave as placed-looking (locked + neutral)
        }
      } else {
        if (isPlaced) chip.classList.add('placed');
      }
    });
  }

  // Render score
  const scoreEl = document.getElementById(`score-${diagramId}`);
  if (scoreEl) {
    if (s.checked && s.score !== null) {
      const total = Object.keys(diag.slots).length;
      scoreEl.classList.add('show');
      scoreEl.classList.remove('all-correct', 'partial', 'none-correct');

      let wrongItems = '';
      if (s.score < total) {
        const wrongSlots = Object.entries(diag.slots).filter(([slotNum, correct]) => {
          return s.placed[parseInt(slotNum)] !== correct;
        });
        wrongItems = `<div class="wrong-answer-note">` +
          wrongSlots.map(([slotNum, correct]) => {
            const given = s.placed[parseInt(slotNum)];
            return `Label ${slotNum}: correct answer is "${correct}"${given ? ` (you placed "${given}")` : ' (not placed)'}`;
          }).join(' &nbsp;|&nbsp; ') +
          `</div>`;
      }

      if (s.score === total) {
        scoreEl.classList.add('all-correct');
        scoreEl.innerHTML = `${s.score} / ${total} correct — Perfect!${wrongItems}`;
      } else if (s.score === 0) {
        scoreEl.classList.add('none-correct');
        scoreEl.innerHTML = `${s.score} / ${total} correct — Keep practising!${wrongItems}`;
      } else {
        scoreEl.classList.add('partial');
        scoreEl.innerHTML = `${s.score} / ${total} correct — Good effort!${wrongItems}`;
      }
    } else {
      scoreEl.classList.remove('show');
    }
  }

  // Update tab button style if completed
  const tabBtn = document.querySelector(`.dtab[data-diagram="${diagramId}"]`);
  if (tabBtn && s.completed) {
    tabBtn.classList.add('done');
  }
}

// ── Handle slot click ─────────────────────────────────────────
function onSlotClick(diagramId, slotNum) {
  const s = state[diagramId];
  if (s.checked) return; // locked after check

  if (s.selectedSlot === slotNum) {
    // Deselect
    s.selectedSlot = null;
  } else {
    // Select this slot
    s.selectedSlot = slotNum;
  }
  renderDiagram(diagramId);
}

// ── Handle word chip click ────────────────────────────────────
function onChipClick(diagramId, term) {
  const s = state[diagramId];
  if (s.checked) return; // locked

  if (s.selectedSlot === null) {
    // No slot selected — try to remove the term if it's already placed somewhere
    const existingSlot = Object.entries(s.placed).find(([, v]) => v === term);
    if (existingSlot) {
      delete s.placed[parseInt(existingSlot[0])];
      renderDiagram(diagramId);
    }
    return;
  }

  // If this term is already placed in another slot, remove it from there
  const existingSlot = Object.entries(s.placed).find(([k, v]) => v === term && parseInt(k) !== s.selectedSlot);
  if (existingSlot) {
    delete s.placed[parseInt(existingSlot[0])];
  }

  // Place the term in the selected slot
  s.placed[s.selectedSlot] = term;
  s.selectedSlot = null; // auto-deselect
  renderDiagram(diagramId);
}

// ── Check answers ─────────────────────────────────────────────
function checkDiagram(diagramId) {
  const diag = DIAGRAMS[diagramId];
  const s    = state[diagramId];
  s.checked  = true;

  let correct = 0;
  Object.entries(diag.slots).forEach(([slotNum, answer]) => {
    if (s.placed[parseInt(slotNum)] === answer) correct++;
  });
  s.score = correct;

  const total = Object.keys(diag.slots).length;
  if (correct === total && !s.completed) {
    s.completed = true;
    Streak.record();
    showToast('All labels correct! Diagram completed.');
    updateSessionScore();
  }

  renderDiagram(diagramId);
}

// ── Reset diagram ─────────────────────────────────────────────
function resetDiagram(diagramId) {
  const s        = state[diagramId];
  s.placed       = {};
  s.selectedSlot = null;
  s.checked      = false;
  s.score        = null;
  // Note: completed stays true once earned
  renderDiagram(diagramId);
}

// ── Wire up tab buttons ───────────────────────────────────────
document.querySelectorAll('.dtab').forEach(btn => {
  btn.addEventListener('click', () => {
    switchDiagram(parseInt(btn.dataset.diagram));
  });
});

// ── Wire up slot groups (event delegation per pane) ──────────
document.querySelectorAll('.diagram-pane').forEach(pane => {
  pane.addEventListener('click', e => {
    const group = e.target.closest('.slot-group');
    if (!group) return;
    const diagramId = parseInt(group.dataset.diagram);
    const slotNum   = parseInt(group.dataset.slot);
    onSlotClick(diagramId, slotNum);
  });
});

// ── Wire up word bank chips (event delegation per bank) ──────
document.querySelectorAll('.word-bank').forEach(bank => {
  const diagramId = parseInt(bank.id.replace('bank-', ''));
  bank.addEventListener('click', e => {
    const chip = e.target.closest('.word-chip');
    if (!chip) return;
    onChipClick(diagramId, chip.dataset.term);
  });
});

// ── Wire up Check / Reset buttons ────────────────────────────
DIAGRAMS.forEach(d => {
  const checkBtn = document.getElementById(`check-${d.id}`);
  const resetBtn = document.getElementById(`reset-${d.id}`);
  if (checkBtn) checkBtn.addEventListener('click', () => checkDiagram(d.id));
  if (resetBtn) resetBtn.addEventListener('click', () => resetDiagram(d.id));
});

// ── Initial render ────────────────────────────────────────────
DIAGRAMS.forEach(d => renderDiagram(d.id));
updateSessionScore();
</script>
</body>
</html>
